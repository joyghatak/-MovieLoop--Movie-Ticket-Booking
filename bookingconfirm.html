<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Booking Confirmation</title>
  <link rel="stylesheet" href="style.css" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body class="centered">
  <div class="card">
    <h1>‚úÖ Booking Confirmed</h1>
    <p><strong>Booking ID:</strong> <span id="confId">Loading...</span></p>
    <p><strong>Name:</strong> <span id="confName">Loading...</span></p>
    <p><strong>Movie:</strong> <span id="confMovie">Loading...</span></p>
    <p><strong>Seats Count:</strong> <span id="confSeats">0</span></p>
    <p><strong>Price Per Seat:</strong> ‚Çπ<span id="confPricePerSeat">0</span></p>
    <p><strong>Total Price:</strong> ‚Çπ<span id="confTotal">0</span></p>
    <button id="downloadBtn">Download Ticket (PDF)</button>
    <a href="movie.html" style="font-size: small; color: #3498db; margin-top: 15px; display: block;">Book Another Movie</a>
  </div>

  <script>
    // Data retrieved from localStorage, populated after successful API call in script.js
    const bookingId = localStorage.getItem("bookingId") || "N/A";
    const name = localStorage.getItem("username") || "N/A";
    const movieName = localStorage.getItem("selectedMovieName") || "N/A"; 
    const seatsCount = localStorage.getItem("confSeats") || 0; 
    const ticketPrice = parseInt(localStorage.getItem("selectedMoviePrice")) || 0; // Price per seat
    const totalPrice = localStorage.getItem("confTotal") || 0; 

    // Data needed for PDF generation
    const seatArray = JSON.parse(localStorage.getItem("selectedSeats")) || []; // Dummy seats from script.js

    // Update DOM
    document.getElementById("confId").innerText = bookingId;
    document.getElementById("confName").innerText = name;
    document.getElementById("confMovie").innerText = movieName;
    document.getElementById("confSeats").innerText = seatsCount;
    document.getElementById("confPricePerSeat").innerText = ticketPrice;
    document.getElementById("confTotal").innerText = totalPrice;

    // PDF Download
    document.getElementById("downloadBtn").addEventListener("click", () => {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();

      // Header
      doc.setFillColor(30, 30, 120);
      doc.rect(0, 0, 210, 30, "F");
      doc.setTextColor(255, 255, 255);
      doc.setFontSize(18);
      doc.setFont("helvetica", "bold");
      doc.text("üéüÔ∏è Movie Ticket Confirmation", 20, 20);

      // Body
      doc.setTextColor(0, 0, 0);
      doc.setFont("helvetica", "normal");
      doc.setFontSize(12);
      let y = 50;
      doc.text(`Booking ID: ${bookingId}`, 20, y);
      doc.text(`Name: ${name}`, 20, y + 10);
      doc.text(`Movie: ${movieName}`, 20, y + 20);
      doc.text(`Seats Booked: ${seatsCount}`, 20, y + 30);
      doc.text(`Price per Seat: ‚Çπ${ticketPrice}`, 20, y + 40);
      doc.text(`Seat Numbers: ${seatArray.join(", ") || "N/A"}`, 20, y + 50);

      // Total Price
      doc.setFont("helvetica", "bold");
      doc.setFontSize(14);
      doc.text(`TOTAL PAID: ‚Çπ${totalPrice}`, 20, y + 65);

      // Footer
      doc.setFont("helvetica", "italic");
      doc.setFontSize(10);
      doc.text("Thank you for booking with MovieLoop!", 20, y + 85);
      doc.text("Enjoy your show üçø", 20, y + 95);
      doc.text(`Date: ${new Date().toLocaleDateString()}`, 150, y + 95);

      // Save PDF
      const safeName = movieName.replace(/\s+/g, "_").replace(/[^\w]/g, "");
      doc.save(`Ticket_${safeName}_${bookingId.substring(0, 8)}.pdf`);
    });
  </script>
</body>
</html>
